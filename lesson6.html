<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>منصة عرض منتجات أردوينو — مؤثرات أنيقة وتفاعل + إضافة صور</title>

  <!-- خط عربي نظيف -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0f1216;
      --card: #171b22;
      --text: #e7ecf3;
      --muted: #a9b3c2;
      --brand: #4db6ff;
      --accent: #74f6c2;
      --danger: #ff6b6b;
      --ok: #7bf58b;
      --border: #28303a;
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0; background:var(--bg); color:var(--text);
      font-family: "Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .container{
      max-width: 1100px; margin: 40px auto; padding: 0 20px;
    }
    header{
      display:flex; align-items:center; gap:16px; flex-wrap:wrap; justify-content:space-between; margin-bottom:20px;
    }
    .title{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:42px; height:42px; border-radius:10px; background:
        radial-gradient(circle at 70% 30%, var(--accent), transparent 35%),
        linear-gradient(135deg, #2b2f36, #141820);
      box-shadow: inset 0 0 20px rgba(116,246,194,0.2), var(--shadow);
      animation: glow 3.5s ease-in-out infinite;
    }
    @keyframes glow {
      0%,100%{box-shadow: inset 0 0 20px rgba(116,246,194,0.2), 0 10px 30px rgba(0,0,0,0.35)}
      50%{box-shadow: inset 0 0 35px rgba(116,246,194,0.35), 0 20px 45px rgba(0,0,0,0.45)}
    }
    h1{font-size: 1.6rem; margin:0}
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .input, .btn{
      background: #12161c; color: var(--text); border:1px solid var(--border);
      border-radius:12px; padding: 12px 14px; outline:none; transition:.25s;
    }
    .input:focus{border-color:var(--brand); box-shadow: 0 0 0 3px rgba(77,182,255,0.15)}
    .btn{cursor:pointer}
    .btn.primary{
      background: linear-gradient(135deg, #1c2633, #17202b);
      border-color:#1f2a39;
    }
    .btn.primary:hover{transform: translateY(-1px); box-shadow: 0 8px 20px rgba(29, 95, 143, 0.3)}
    .grid{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(260px,1fr));
      gap:18px; margin-top:20px;
    }
    .card{
      background: var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden;
      box-shadow: var(--shadow); position:relative; transform: translateY(0);
      transition: transform .25s, box-shadow .25s, border-color .25s;
    }
    .card:hover{transform: translateY(-4px); box-shadow: 0 20px 45px rgba(0,0,0,0.45); border-color:#334052}
    .media{
      aspect-ratio: 16/10; background: #0c0f13; position:relative; overflow:hidden;
    }
    .media img{
      width:100%; height:100%; object-fit: cover; opacity:.96;
      transform: scale(1.02); transition: transform .5s ease;
    }
    .card:hover .media img{transform: scale(1.06)}
    .badge{
      position:absolute; top:10px; left:10px; background:#12253a; color:#9fd3ff; border:1px solid #1e3a59;
      padding:6px 10px; border-radius:999px; font-size:.82rem; backdrop-filter: blur(6px);
    }
    .content{padding:14px 14px 12px}
    .name{font-weight:800; font-size:1.05rem; margin:0 0 4px}
    .meta{display:flex; gap:8px; flex-wrap:wrap; color:var(--muted); font-size:.9rem; margin-bottom:10px}
    .price{
      display:flex; align-items:center; gap:10px; margin:10px 0 12px;
    }
    .current{color:var(--ok); font-weight:800}
    .old{color:#8893a3; text-decoration: line-through}
    .specs{
      display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px;
    }
    .chip{
      background:#11161c; border:1px solid #243041; color:#cfe6ff; padding:6px 9px; border-radius:10px; font-size:.85rem
    }
    .actions{display:flex; gap:8px}
    .btn.link{
      background: #12161c; border:1px dashed #2b3a4e; color:#9fd3ff;
    }
    .btn.add{
      background: #12251c; border:1px solid #204634; color:#9ff6ce;
    }
    .btn.add:hover{background:#173224}

    /* قسم إضافة الصور */
    .uploader{
      margin-top:30px; background:#12161c; border:1px dashed #2b3a4e; border-radius:14px; padding:16px;
    }
    .uploader h3{margin:0 0 8px}
    .drop{
      margin-top:8px; border:2px dashed #36506a; border-radius:12px; padding:20px; text-align:center; color:#9fd3ff;
      transition: .25s; background: #0f141a;
    }
    .drop.dragover{
      border-color: var(--accent); color: var(--accent); background: #0c1713;
      box-shadow: inset 0 0 25px rgba(116, 246, 194, 0.15);
    }
    .gallery{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
      gap:10px; margin-top:14px;
    }
    .thumb{
      position:relative; border:1px solid #2b3a4e; border-radius:10px; overflow:hidden;
      background:#0b0f14;
    }
    .thumb img{width:100%; height:120px; object-fit:cover}
    .remove{
      position:absolute; top:8px; left:8px; background:#1b1010; color:#ffb1b1;
      border:1px solid #4a2222; padding:5px 8px; border-radius:999px; font-size:.8rem; cursor:pointer;
    }

    /* شريط إشعارات أنيق */
    .toast{
      position:fixed; bottom:20px; inset-inline:20px auto; background:#11161c; border:1px solid #2b3a4e;
      padding:10px 12px; border-radius:12px; color:#cfe6ff; box-shadow: var(--shadow);
      transform: translateY(20px); opacity:0; pointer-events:none; transition: .35s;
      max-width: 420px;
    }
    .toast.show{transform: translateY(0); opacity:1; pointer-events:auto}

    /* حركة ظهور تدريجية */
    .fade-enter{
      animation: fadeIn .5s ease both;
    }
    @keyframes fadeIn {
      from{opacity:0; transform: translateY(8px)}
      to{opacity:1; transform: translateY(0)}
    }

    /* شريط أدوات ثانوي */
    .filters{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .select{
      appearance:none; background:#12161c; color:var(--text); border:1px solid var(--border); border-radius:12px;
      padding:12px 14px;
      background-image: linear-gradient(180deg, transparent, transparent), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="%23a9b3c2"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat:no-repeat; background-position: left 10px center; background-size: 18px;
      padding-left:36px;
    }

    /* نسخة للطباعة/تصدير */
    @media print{
      .uploader, .filters, .toolbar, .toast{display:none}
      body{background:white; color:black}
      .card{border-color:#ddd; box-shadow:none}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title fade-enter">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>منصة عرض منتجات أردوينو</h1>
          <div style="color:var(--muted); font-size:.95rem">مؤثرات أنيقة، تفاعل سريع، وإضافة صور محلية بدون رفع</div>
        </div>
      </div>

      <div class="toolbar fade-enter" style="animation-delay:.05s">
        <input id="q" class="input" type="search" placeholder="ابحث بالاسم أو المعالج..." />
        <button id="exportBtn" class="btn">تصدير الصور</button>
        <button id="clearBtn" class="btn">تفريغ الصور</button>
        <button id="darkBtn" class="btn primary">تبديل النمط</button>
      </div>
    </header>

    <div class="filters fade-enter" style="animation-delay:.1s">
      <select id="sort" class="select" title="ترتيب">
        <option value="default">الترتيب الافتراضي</option>
        <option value="price-asc">السعر: من الأقل للأعلى</option>
        <option value="price-desc">السعر: من الأعلى للأقل</option>
      </select>
      <select id="filter" class="select" title="فلترة">
        <option value="all">جميع اللوحات</option>
        <option value="mega">Mega</option>
        <option value="nano">Nano</option>
        <option value="promini">Pro Mini</option>
        <option value="promicro">Pro Micro</option>
      </select>
    </div>

    <section id="grid" class="grid">
      <!-- يتم حقن البطاقات عبر JS -->
    </section>

    <section class="uploader fade-enter" style="animation-delay:.15s">
      <h3>إضافة صور محليًا</h3>
      <div style="color:var(--muted)">اسحب وأفلت صورك هنا أو استخدم الزر لاختيار ملفات. سيتم حفظها محليًا ويمكن ربطها بالبطاقات.</div>
      <div id="drop" class="drop">اسحب الصور هنا</div>
      <div style="display:flex; gap:10px; margin-top:10px">
        <input id="file" type="file" accept="image/*" multiple class="input" />
        <button id="assignBtn" class="btn add">ربط الصورة بالبطاقة المحددة</button>
      </div>
      <div id="gallery" class="gallery"></div>
    </section>
  </div>

  <div id="toast" class="toast">تمت العملية بنجاح.</div>

  <script>
    // بيانات المنتجات (من روابط المصدر)
    const products = [
      {
        id: "mega",
        name: "Arduino MEGA 2560 (CH340)",
        url: "https://makerselectronics.com/product/arduino-mega-2560/",
        image: "https://i0.wp.com/makerselectronics.com/wp-content/uploads/2016/02/transparent-Photoroom1.jpg?fit=500%2C500&ssl=1",
        price: 900, // EGP
        oldPrice: 1250,
        mcu: "ATmega2560",
        clock: "16MHz",
        io: "54 Digital I/O (15 PWM), 16 Analog",
        notes: "4 منافذ UART، USB CH340، توافق كامل مع Arduino IDE",
        chips: ["5V", "256KB Flash", "8KB SRAM", "4KB EEPROM"]
      },
      {
        id: "nano",
        name: "Arduino Nano ATmega328PB-U (CH340C)",
        url: "https://makerselectronics.com/product/arduino-nano-atmega328pb-u/",
        image: "https://i0.wp.com/makerselectronics.com/wp-content/uploads/2023/08/6b04ebd2-5e99-466c-a130-32bf5b20667c_800x800-800x800.jpeg?fit=510%2C510&ssl=1",
        price: 240,
        oldPrice: null,
        mcu: "ATmega328PB-U",
        clock: "16MHz",
        io: "14 Digital I/O (6 PWM), 8 Analog",
        notes: "Micro USB، USB-Serial CH340C، يحتاج تعريف CH340 في بعض الأنظمة",
        chips: ["5V", "32KB Flash", "2KB SRAM", "1KB EEPROM"]
      },
      {
        id: "promini",
        name: "Arduino Pro Mini 5V/16MHz (ATmega328P)",
        url: "https://makerselectronics.com/product/arduino-pro-mini-atmega328pu-th-5v-16mhz/",
        image: "https://i0.wp.com/makerselectronics.com/wp-content/uploads/2016/02/arduino-pro-mini-2-1-1000x1000.jpg?fit=510%2C510&ssl=1",
        price: 150,
        oldPrice: 225,
        mcu: "ATmega328P U-TH",
        clock: "16MHz",
        io: "14 Digital I/O (6 PWM), 8 Analog",
        notes: "بدون USB مدمج — يحتاج USB-to-Serial للبرمجة",
        chips: ["5V", "32KB Flash", "2KB SRAM", "1KB EEPROM"]
      },
      {
        id: "promicro",
        name: "Arduino Pro Micro 5V/16MHz (ATmega32U4, Type‑C)",
        url: "https://makerselectronics.com/product/arduino-pro-micro-atmega32u4-mu-t-c/",
        image: "https://i0.wp.com/makerselectronics.com/wp-content/uploads/2025/03/61Am7EjTlaL._AC_SX679_.png?fit=510%2C511&ssl=1",
        price: 350,
        oldPrice: 450,
        mcu: "ATmega32U4-MU",
        clock: "16MHz",
        io: "12 Digital I/O (5 PWM), 9 Analog",
        notes: "USB مدمج (Type‑C)، يدعم أجهزة USB المخصصة (HID)",
        chips: ["5V", "32KB Flash", "2.5KB SRAM", "1KB EEPROM"]
      }
    ];

    // حالة عامة
    const state = {
      dark: true,
      images: JSON.parse(localStorage.getItem("gallery") || "[]"), // صور مضافة
      assigned: JSON.parse(localStorage.getItem("assigned") || "{}"), // { productId: [imageDataURL,...] }
      selectedCard: null
    };

    // عناصر DOM
    const grid = document.getElementById("grid");
    const q = document.getElementById("q");
    const sortSel = document.getElementById("sort");
    const filterSel = document.getElementById("filter");
    const drop = document.getElementById("drop");
    const file = document.getElementById("file");
    const gallery = document.getElementById("gallery");
    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");
    const darkBtn = document.getElementById("darkBtn");
    const assignBtn = document.getElementById("assignBtn");
    const toast = document.getElementById("toast");

    // أدوات مساعدة
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=> toast.classList.remove("show"), 2000);
    }

    function save(){
      localStorage.setItem("gallery", JSON.stringify(state.images));
      localStorage.setItem("assigned", JSON.stringify(state.assigned));
    }

    function currency(n){ return `${n.toFixed(0)} EGP`; }

    // بناء بطاقة
    function cardTemplate(p){
      const assignedImgs = (state.assigned[p.id] || []);
      const assignedHTML = assignedImgs.length ? `
        <div class="gallery" style="margin-top:8px">
          ${assignedImgs.map((src, i)=> `
            <div class="thumb">
              <img src="${src}" alt="صورة مرتبطة">
              <button class="remove" data-p="${p.id}" data-i="${i}">حذف</button>
            </div>
          `).join("")}
        </div>
      ` : "";

      return `
        <article class="card fade-enter" data-id="${p.id}">
          <div class="media">
            <img src="${p.image}" alt="${p.name}">
            <div class="badge">${p.mcu} • ${p.clock}</div>
          </div>
          <div class="content">
            <h3 class="name">${p.name}</h3>
            <div class="meta">${p.io}</div>
            <div class="price">
              <div class="current">${currency(p.price)}</div>
              ${p.oldPrice ? `<div class="old">${currency(p.oldPrice)}</div>` : ""}
            </div>
            <div class="specs">
              ${p.chips.map(c=> `<span class="chip">${c}</span>`).join("")}
            </div>
            <div style="color:var(--muted); font-size:.9rem; margin-bottom:12px">${p.notes}</div>
            <div class="actions">
              <button class="btn link" data-url="${p.url}">فتح صفحة المنتج</button>
              <button class="btn add" data-select="${p.id}">تحديد للربط</button>
            </div>
            ${assignedHTML}
          </div>
        </article>
      `;
    }

    // رسم الشبكة
    function render(){
      let list = [...products];

      // فلترة بالاسم/المعالج
      const qv = q.value.trim().toLowerCase();
      if(qv){
        list = list.filter(p =>
          p.name.toLowerCase().includes(qv) ||
          p.mcu.toLowerCase().includes(qv)
        );
      }

      // فلترة نوع اللوحة
      switch(filterSel.value){
        case "mega": list = list.filter(p=> p.id==="mega"); break;
        case "nano": list = list.filter(p=> p.id==="nano"); break;
        case "promini": list = list.filter(p=> p.id==="promini"); break;
        case "promicro": list = list.filter(p=> p.id==="promicro"); break;
        default: break;
      }

      // ترتيب
      if(sortSel.value==="price-asc"){
        list.sort((a,b)=> a.price - b.price);
      } else if(sortSel.value==="price-desc"){
        list.sort((a,b)=> b.price - a.price);
      }

      grid.innerHTML = list.map(cardTemplate).join("");

      // ربط أحداث داخل البطاقات
      grid.querySelectorAll(".btn.link").forEach(btn=>{
        btn.addEventListener("click", ()=> {
          window.open(btn.dataset.url, "_blank");
        });
      });
      grid.querySelectorAll(".btn.add").forEach(btn=>{
        btn.addEventListener("click", ()=> {
          state.selectedCard = btn.dataset.select;
          showToast("تم تحديد البطاقة للربط. الآن اختر صورًا ثم اضغط \"ربط الصورة\"");
        });
      });
      grid.querySelectorAll(".remove").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const pid = btn.dataset.p;
          const idx = +btn.dataset.i;
          const arr = state.assigned[pid] || [];
          arr.splice(idx,1);
          state.assigned[pid] = arr;
          save(); render();
          showToast("تم حذف الصورة المرتبطة.");
        });
      });
    }

    // إدارة المعرض العام
    function renderGallery(){
      gallery.innerHTML = state.images.map((src, i)=> `
        <div class="thumb">
          <img src="${src}" alt="صورة محلية">
          <button class="remove" data-i="${i}">حذف</button>
        </div>
      `).join("");
      gallery.querySelectorAll(".remove").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const idx = +btn.dataset.i;
          state.images.splice(idx,1);
          save(); renderGallery();
          showToast("تم حذف الصورة من المعرض.");
        });
      });
    }

    // قراءة ملفات الصور
    function readFiles(files){
      const promises = [];
      for(const f of files){
        if(!f.type.startsWith("image/")) continue;
        const reader = new FileReader();
        promises.push(new Promise(res=>{
          reader.onload = ()=> res(reader.result);
          reader.readAsDataURL(f);
        }));
      }
      Promise.all(promises).then(urls=>{
        if(!urls.length){
          showToast("لم يتم اختيار صور.");
          return;
        }
        state.images.push(...urls);
        save(); renderGallery();
        showToast("تمت إضافة الصور إلى المعرض.");
      });
    }

    // سحب وإفلات
    drop.addEventListener("dragover", (e)=>{
      e.preventDefault();
      drop.classList.add("dragover");
    });
    drop.addEventListener("dragleave", ()=>{
      drop.classList.remove("dragover");
    });
    drop.addEventListener("drop", (e)=>{
      e.preventDefault();
      drop.classList.remove("dragover");
      readFiles(e.dataTransfer.files);
    });
    file.addEventListener("change", (e)=>{
      readFiles(e.target.files);
      file.value = "";
    });

    // ربط صورة مختارة بالبطاقة المحددة
    assignBtn.addEventListener("click", ()=>{
      if(!state.selectedCard){
        showToast("اختر بطاقة أولًا بالضغط على \"تحديد للربط\".");
        return;
      }
      if(!state.images.length){
        showToast("أضف صورًا إلى المعرض أولًا.");
        return;
      }
      // نربط آخر صورة مضافة (يمكن تعديل المنطق)
      const last = state.images[state.images.length-1];
      const arr = state.assigned[state.selectedCard] || [];
      arr.push(last);
      state.assigned[state.selectedCard] = arr;
      save(); render();
      showToast("تم ربط الصورة بالبطاقة المحددة.");
    });

    // بحث/ترتيب/فلترة
    q.addEventListener("input", render);
    sortSel.addEventListener("change", render);
    filterSel.addEventListener("change", render);

    // تصدير الصور (JSON)
    exportBtn.addEventListener("click", ()=>{
      const data = {
        gallery: state.images,
        assigned: state.assigned
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "arduino-images-export.json";
      a.click();
      URL.revokeObjectURL(url);
      showToast("تم تصدير الصور والروابط.");
    });

    // تفريغ الصور
    clearBtn.addEventListener("click", ()=>{
      if(!confirm("تأكيد تفريغ جميع الصور والمعينات؟")) return;
      state.images = [];
      state.assigned = {};
      save(); renderGallery(); render();
      showToast("تم التفريغ.");
    });

    // تبديل النمط (يمكن توسيع لاحقًا)
    darkBtn.addEventListener("click", ()=>{
      state.dark = !state.dark;
      document.documentElement.style.setProperty('--bg', state.dark ? '#0f1216' : '#f6f8fb');
      document.documentElement.style.setProperty('--card', state.dark ? '#171b22' : '#ffffff');
      document.documentElement.style.setProperty('--text', state.dark ? '#e7ecf3' : '#14202e');
      document.documentElement.style.setProperty('--muted', state.dark ? '#6c7b8e' : '#5b6a7c');
      document.documentElement.style.setProperty('--border', state.dark ? '#28303a' : '#dfe6ee');
      showToast(state.dark ? "تم تفعيل النمط الداكن." : "تم تفعيل النمط الفاتح.");
    });

    // بدء
    render();
    renderGallery();
  </script>
</body>
</html>
