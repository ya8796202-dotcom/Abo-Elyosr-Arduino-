<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>معرض صور أردوينو — صور من  + رفع المستخدم</title>
  <meta name="description" content="صفحة HTML واحدة تعرض صور فوتوغرافية لأنواع أردوينو مأخوذة من Wikimedia Commons، مع إمكانية إضافة صور من جهازك أو عبر رابط، حفظ محلي، بحث، فلتر، وعرض كامل (lightbox)." />
  <style>
    :root{
      --bg:#07102a; --panel:#071428; --card:#0b1224; --accent:#1d4ed8; --accent2:#06b6d4;
      --text:#e6eef8; --muted:#93c5fd; --glass:rgba(255,255,255,0.03);
      --radius:12px; --shadow:0 14px 40px rgba(2,6,23,.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,"Noto Naskh Arabic",Tahoma,Arial; background:linear-gradient(180deg,#041026,#07102a);
      color:var(--text); -webkit-font-smoothing:antialiased; padding:20px;
    }

    header{display:flex;gap:12px;align-items:center;max-width:1200px;margin:0 auto 18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 30px rgba(29,78,216,.12)}
    h1{margin:0;font-size:20px}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}

    .container{max-width:1200px;margin:18px auto;display:grid;gap:14px;padding:0 8px}
    .panel{background:linear-gradient(180deg,#071428,#061026);border-radius:16px;padding:14px;border:1px solid var(--glass);box-shadow:var(--shadow)}

    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .search{flex:1;display:flex;gap:8px;align-items:center}
    .input, .select, .btn{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071428;color:var(--text)}
    .input{flex:1}
    .select{width:160px}
    .btn{cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#022;font-weight:800}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--text);font-weight:700}
    .small{font-size:13px;color:var(--muted)}

    .uploader{display:flex;gap:10px;align-items:center;padding:12px;border-radius:12px;border:1px dashed rgba(255,255,255,.04);background:linear-gradient(180deg,rgba(255,255,255,.01),transparent)}
    .uploader.dragover{border-color:rgba(29,78,216,.9);box-shadow:0 8px 30px rgba(29,78,216,.06)}
    .file-preview img{width:64px;height:48px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.04)}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:linear-gradient(180deg,#071428,#061026);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.03);transition:transform .28s ease, box-shadow .28s ease}
    .card:hover{transform:translateY(-8px) scale(1.01);box-shadow:0 20px 40px rgba(2,6,23,.7)}
    .thumb{position:relative;overflow:hidden;background:#000;height:180px;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover;transition:transform .6s cubic-bezier(.2,.9,.2,1);transform-origin:center}
    .card:hover .thumb img{transform:scale(1.08) rotate(.3deg)}
    .meta{padding:12px;display:flex;flex-direction:column;gap:8px}
    .meta h3{margin:0;font-size:15px;color:#a5b4fc}
    .meta p{margin:0;color:var(--muted);font-size:13px}
    .tags{display:flex;gap:8px;flex-wrap:wrap}
    .tag{background:rgba(255,255,255,.03);padding:6px 8px;border-radius:999px;font-size:12px;color:#cfe8ff}

    .actions{display:flex;gap:8px;padding:12px;border-top:1px solid rgba(255,255,255,.02);align-items:center}
    .actions .btn{padding:8px 10px;font-size:13px}
    .actions .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.04)}

    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(0,0,0,.6),rgba(0,0,0,.85));z-index:120}
    .lightbox.open{display:flex}
    .lightbox .panel{max-width:1100px;width:92%;border-radius:12px;overflow:hidden;background:#000;border:1px solid rgba(255,255,255,.04)}
    .lightbox img{width:100%;height:auto;display:block}
    .lightbox .caption{padding:12px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}

    @keyframes fadeInUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
    .card{animation:fadeInUp .36s ease both}

    @media (max-width:720px){
      .thumb{height:160px}
      .controls{flex-direction:column;align-items:stretch}
      .select{width:100%}
    }
  </style>
</head>
<body>
  <header>
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>معرض صور أردوينو — من Wikimedia</h1>
      <p class="lead">صور فوتوغرافية لأنواع أردوينو مأخوذة من Wikimedia Commons. أضف صورًا من جهازك أو عبر رابط، واحفظها محليًا.</p>
    </div>
  </header>

  <main class="container">
    <section class="panel" aria-labelledby="controlsTitle">
      <div id="controlsTitle" class="small" style="margin-bottom:8px">أدوات المعرض</div>

      <div class="controls" role="region" aria-label="أدوات">
        <div class="search">
          <input id="search" class="input" placeholder="ابحث بعنوان أو وسم (مثال: Uno, ESP32, Nano)..." />
          <select id="filterLevel" class="select" aria-label="فلتر المستوى">
            <option value="">كل المستويات</option>
            <option value="beginner">مبتدئ</option>
            <option value="intermediate">متوسط</option>
            <option value="advanced">متقدم</option>
          </select>
        </div>

        <div style="display:flex;gap:8px">
          <button id="resetDefaults" class="btn ghost">إعادة الصور الافتراضية</button>
          <button id="clearLocal" class="btn ghost">مسح الصور المضافة</button>
        </div>
      </div>

      <div id="uploader" class="uploader" aria-label="منطقة رفع الصور">
        <div style="flex:1;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input id="fileInput" type="file" accept="image/*" style="display:none" />
          <button id="chooseBtn" class="btn ghost">اختر صورة</button>
          <input id="urlInput" class="input" placeholder="أو ألصق رابط صورة (URL من Wikimedia أو أي مصدر)" />
          <input id="titleInput" class="input" placeholder="عنوان الصورة (اختياري)" style="width:220px" />
          <select id="levelInput" class="select" style="width:140px">
            <option value="">مستوى</option><option value="beginner">مبتدئ</option><option value="intermediate">متوسط</option><option value="advanced">متقدم</option>
          </select>
          <button id="addBtn" class="btn">أضف</button>
        </div>
        <div style="width:100%;margin-top:8px;color:var(--muted);font-size:13px">اسحب الصورة إلى هنا أو استخدم زر "اختر صورة". الصور المضافة تحفظ محليًا في المتصفح.</div>
      </div>

      <div style="height:12px"></div>

      <div id="gallery" class="grid" aria-live="polite"></div>
    </section>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" role="dialog" aria-hidden="true">
    <div class="panel">
      <img id="lightboxImg" alt="عرض الصورة" />
      <div class="caption">
        <div id="lightboxTitle" style="font-weight:700;color:#dbeafe"></div>
        <div style="display:flex;gap:8px">
          <button id="downloadBtn" class="btn ghost">تحميل</button>
          <button id="closeLightbox" class="btn ghost">إغلاق</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // مفاتيح التخزين
    const STORAGE_KEY = 'arduino_wikimedia_gallery_v1';
    const DEFAULTS_KEY = 'arduino_wikimedia_defaults_v1';

    // صور افتراضية من Wikimedia Commons (روابط مباشرة)
    const defaultItems = [
      { id:'uno', title:'Arduino Uno R3', src:'https://upload.wikimedia.org/wikipedia/commons/3/38/Arduino_Uno_-_R3.jpg', level:'beginner', tags:['uno','arduino'] },
      { id:'nano', title:'Arduino Nano v3.0', src:'https://upload.wikimedia.org/wikipedia/commons/6/6e/Arduino_Nano_v3.0.jpg', level:'beginner', tags:['nano','arduino'] },
      { id:'mega', title:'Arduino Mega 2560', src:'https://upload.wikimedia.org/wikipedia/commons/3/3f/Arduino_Mega_2560.jpg', level:'advanced', tags:['mega','arduino'] },
      { id:'leonardo', title:'Arduino Leonardo', src:'https://upload.wikimedia.org/wikipedia/commons/4/4d/Arduino_Leonardo.jpg', level:'intermediate', tags:['leonardo','arduino'] },
      { id:'due', title:'Arduino Due', src:'https://upload.wikimedia.org/wikipedia/commons/2/28/Arduino_Due.jpg', level:'advanced', tags:['due','arduino'] },
      { id:'promini', title:'Arduino Pro Mini', src:'https://upload.wikimedia.org/wikipedia/commons/0/0c/Arduino_Pro_Mini.jpg', level:'intermediate', tags:['promini','arduino'] },
      { id:'micro', title:'Arduino Micro', src:'https://upload.wikimedia.org/wikipedia/commons/1/1b/Arduino_Micro.jpg', level:'intermediate', tags:['micro','arduino'] },
      { id:'esp8266', title:'ESP8266 NodeMCU', src:'https://upload.wikimedia.org/wikipedia/commons/3/3d/NodeMCU_DEVKIT_v1.0.jpg', level:'intermediate', tags:['esp8266','wifi'] },
      { id:'esp32', title:'ESP32 DevKitC', src:'https://upload.wikimedia.org/wikipedia/commons/9/92/ESP32-DevKitC.jpg', level:'intermediate', tags:['esp32','wifi','ble'] },
      { id:'rp2040', title:'Arduino Nano RP2040 Connect', src:'https://upload.wikimedia.org/wikipedia/commons/6/6b/Arduino_Nano_RP2040_Connect.jpg', level:'advanced', tags:['rp2040','nano'] }
    ];

    // حفظ النسخة الافتراضية إن لم تكن محفوظة
    if(!localStorage.getItem(DEFAULTS_KEY)) localStorage.setItem(DEFAULTS_KEY, JSON.stringify(defaultItems));

    // تحميل المعرض من localStorage أو تهيئته بالقيم الافتراضية
    function loadGallery(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultItems));
          return defaultItems.slice();
        }
        return JSON.parse(raw);
      }catch(e){
        console.error('loadGallery error', e);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(defaultItems));
        return defaultItems.slice();
      }
    }

    function saveGallery(items){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    }

    let items = loadGallery();

    // عناصر DOM
    const galleryEl = document.getElementById('gallery');
    const searchEl = document.getElementById('search');
    const filterLevelEl = document.getElementById('filterLevel');
    const fileInput = document.getElementById('fileInput');
    const chooseBtn = document.getElementById('chooseBtn');
    const urlInput = document.getElementById('urlInput');
    const titleInput = document.getElementById('titleInput');
    const levelInput = document.getElementById('levelInput');
    const addBtn = document.getElementById('addBtn');
    const uploader = document.getElementById('uploader');
    const resetDefaultsBtn = document.getElementById('resetDefaults');
    const clearLocalBtn = document.getElementById('clearLocal');

    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const lightboxTitle = document.getElementById('lightboxTitle');
    const closeLightbox = document.getElementById('closeLightbox');
    const downloadBtn = document.getElementById('downloadBtn');

    // مساعدة: معرف فريد
    function uid(){ return 'id_' + Math.random().toString(36).slice(2,9); }
    function escapeHtml(s){ return String(s || '').replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[ch])); }

    // عرض المعرض
    function render(){
      galleryEl.innerHTML = '';
      const q = (searchEl.value || '').trim().toLowerCase();
      const level = filterLevelEl.value;
      const filtered = items.filter(it => {
        const text = (it.title + ' ' + (it.tags||[]).join(' ')).toLowerCase();
        const matchesQ = !q || text.includes(q);
        const matchesLevel = !level || it.level === level;
        return matchesQ && matchesLevel;
      });

      if(filtered.length === 0){
        galleryEl.innerHTML = `<div style="grid-column:1/-1;padding:28px;text-align:center;color:var(--muted);border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,.01),transparent)">لا توجد صور مطابقة</div>`;
        return;
      }

      filtered.forEach(it => {
        const card = document.createElement('article');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.setAttribute('data-id', it.id);
        thumb.setAttribute('role','button');
        thumb.setAttribute('tabindex','0');

        const img = document.createElement('img');
        img.loading = 'lazy';
        img.alt = it.title || '';
        img.src = it.src;
        img.addEventListener('error', ()=> {
          img.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="600" height="360"><rect width="100%" height="100%" fill="#071428"/><text x="50%" y="50%" fill="#93c5fd" font-size="18" font-family="Arial" dominant-baseline="middle" text-anchor="middle">فشل تحميل الصورة</text></svg>`);
        });

        thumb.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const h3 = document.createElement('h3'); h3.textContent = it.title || 'صورة';
        const p = document.createElement('p'); p.className = 'small'; p.textContent = (it.level || '') + (it.tags && it.tags.length ? ' • ' + it.tags.join(', ') : '');
        const tagsWrap = document.createElement('div'); tagsWrap.className = 'tags';
        (it.tags || []).slice(0,4).forEach(t => {
          const span = document.createElement('span'); span.className = 'tag'; span.textContent = t;
          tagsWrap.appendChild(span);
        });
        meta.appendChild(h3); meta.appendChild(p); meta.appendChild(tagsWrap);

        const actions = document.createElement('div'); actions.className = 'actions';
        const viewBtn = document.createElement('button'); viewBtn.className = 'btn ghost'; viewBtn.textContent = 'عرض'; viewBtn.dataset.id = it.id;
        const copyBtn = document.createElement('button'); copyBtn.className = 'btn ghost'; copyBtn.textContent = 'نسخ الرابط'; copyBtn.dataset.id = it.id;
        const delBtn = document.createElement('button'); delBtn.className = 'btn ghost'; delBtn.textContent = 'حذف'; delBtn.dataset.id = it.id;
        actions.appendChild(viewBtn); actions.appendChild(copyBtn); actions.appendChild(delBtn);

        card.appendChild(thumb); card.appendChild(meta); card.appendChild(actions);
        galleryEl.appendChild(card);
      });
    }

    // فتح lightbox
    function openLightbox(item){
      lightboxImg.src = item.src;
      lightboxTitle.textContent = item.title || '';
      downloadBtn.onclick = ()=> {
        const a = document.createElement('a');
        a.href = item.src;
        a.download = (item.title || 'image') + '.jpg';
        document.body.appendChild(a);
        a.click();
        a.remove();
      };
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden','false');
    }

    // تعامل مع أزرار داخل المعرض
    galleryEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(btn){
        const id = btn.dataset.id;
        const item = items.find(x=>x.id === id);
        if(!item) return;
        if(btn.textContent.includes('عرض')) openLightbox(item);
        else if(btn.textContent.includes('نسخ')) {
          navigator.clipboard.writeText(item.src).then(()=> {
            const old = btn.textContent; btn.textContent = 'تم النسخ ✅';
            setTimeout(()=> btn.textContent = old, 1200);
          }).catch(()=> alert('فشل النسخ'));
        } else if(btn.textContent.includes('حذف')) {
          if(!confirm('حذف هذه الصورة من المعرض؟')) return;
          items = items.filter(x=>x.id !== id);
          saveGallery(items);
          render();
        }
      } else {
        // click on thumb
        const thumb = e.target.closest('.thumb');
        if(thumb){
          const id = thumb.dataset.id;
          const item = items.find(x=>x.id === id);
          if(item) openLightbox(item);
        }
      }
    });

    // دعم فتح بالكيبورد
    galleryEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        const thumb = e.target.closest('.thumb');
        if(thumb){
          const id = thumb.dataset.id;
          const item = items.find(x=>x.id === id);
          if(item) openLightbox(item);
        }
      }
    });

    // إغلاق lightbox
    closeLightbox.addEventListener('click', ()=> {
      lightbox.classList.remove('open');
      lightbox.setAttribute('aria-hidden','true');
      lightboxImg.src = '';
    });
    lightbox.addEventListener('click', (e)=> { if(e.target === lightbox) closeLightbox.click(); });

    // بحث وفلتر
    searchEl.addEventListener('input', render);
    filterLevelEl.addEventListener('change', render);

    // اختيار ملف
    chooseBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', ()=> {
      const f = fileInput.files[0];
      if(!f) return;
      previewAndAddFile(f);
    });

    // سحب وإفلات
    ['dragenter','dragover'].forEach(ev => uploader.addEventListener(ev, (e)=> { e.preventDefault(); uploader.classList.add('dragover'); }));
    ['dragleave','drop'].forEach(ev => uploader.addEventListener(ev, (e)=> { e.preventDefault(); uploader.classList.remove('dragover'); }));
    uploader.addEventListener('drop', (e)=> {
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) previewAndAddFile(f);
    });

    // إضافة عبر رابط أو ملف
    addBtn.addEventListener('click', ()=> {
      const url = urlInput.value.trim();
      const title = titleInput.value.trim() || 'صورة مضافة';
      const level = levelInput.value || '';
      if(url){
        const id = uid();
        items.unshift({ id, title, src: url, level, tags: extractTags(title) });
        saveGallery(items);
        urlInput.value = ''; titleInput.value = ''; levelInput.value = '';
        render();
        return;
      }
      const f = fileInput.files[0];
      if(f){
        previewAndAddFile(f);
        return;
      }
      alert('اختر ملفًا أو ألصق رابط صورة ثم اضغط أضف');
    });

    // قراءة ملف وتحويله إلى DataURL ثم الإضافة
    function previewAndAddFile(file){
      if(!file.type.startsWith('image/')){ alert('الملف ليس صورة'); return; }
      const reader = new FileReader();
      reader.onload = function(e){
        const src = e.target.result;
        const title = titleInput.value.trim() || file.name || 'صورة مضافة';
        const level = levelInput.value || '';
        const id = uid();
        items.unshift({ id, title, src, level, tags: extractTags(title), user:true });
        saveGallery(items);
        fileInput.value = ''; urlInput.value = ''; titleInput.value = ''; levelInput.value = '';
        render();
      };
      reader.readAsDataURL(file);
    }

    // استخراج وسوم بسيطة من العنوان
    function extractTags(title){
      return title.split(/[\s,._-]+/).slice(0,6).map(s=>s.toLowerCase()).filter(Boolean);
    }

    // إعادة الافتراضيات
    resetDefaultsBtn.addEventListener('click', ()=> {
      if(!confirm('إعادة الصور إلى المجموعة الافتراضية (سيُحذف كل الصور المضافة)؟')) return;
      const defaults = JSON.parse(localStorage.getItem(DEFAULTS_KEY) || '[]');
      items = defaults.slice();
      saveGallery(items);
      render();
    });

    // مسح الصور المضافة (الاحتفاظ بالافتراضيات)
    clearLocalBtn.addEventListener('click', ()=> {
      if(!confirm('حذف كل الصور المضافة من جهازك؟')) return;
      const defaults = JSON.parse(localStorage.getItem(DEFAULTS_KEY) || '[]');
      const defaultSrcs = new Set(defaults.map(d=>d.src));
      items = items.filter(it => defaultSrcs.has(it.src));
      saveGallery(items);
      render();
    });

    // بدء العرض
    render();

    // اختصار لوحة مفاتيح: Ctrl+K للبحث
    document.addEventListener('keydown', (e)=> { if(e.ctrlKey && e.key.toLowerCase() === 'k'){ e.preventDefault(); searchEl.focus(); } });

    // حفظ المعرض
    function saveGallery(items){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }

    // expose for debugging
    window.__arduinoGallery = { render, items, saveGallery };
  </script>
</body>
</html>
