<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ù†ØµØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„ØªØ¹Ù„Ù… Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ â€” 10 Ù…Ø³ØªÙˆÙŠØ§Øª</title>
  <meta name="description" content="Ù…Ù„Ù ÙˆØ§Ø­Ø¯: Ø¯Ø±ÙˆØ³ Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ ØªÙØ§Ø¹Ù„ÙŠØ©ØŒ Ù…Ø­Ø±Ø± ÙƒÙˆØ¯ØŒ Ø§Ù…ØªØ­Ø§Ù†Ø§ØªØŒ Ù†Ù‚Ø§Ø· ÙˆØ´Ø§Ø±Ø§Øª. Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub." />
  <!--
    ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„Ø±ÙØ¹ Ø¹Ù„Ù‰ GitHub:
    1. Ø§Ø­ÙØ¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… index.html.
    2. Ø£Ù†Ø´Ø¦ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ GitHub ÙˆØ§Ø¯ÙØ¹ Ø§Ù„Ù…Ù„Ù.
    3. ÙØ¹Ù‘Ù„ GitHub Pages Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©.
  -->
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1224; --panel2:#111827; --me:#1d4ed8; --them:#374151;
      --text:#e5e7eb; --accent:#60a5fa; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,"Segoe UI",Tahoma,Arial; background:
      radial-gradient(900px 480px at 70% -10%, #142045 0%, var(--bg) 60%), var(--bg);
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{position:sticky; top:0; z-index:20; background:rgba(8,12,24,.75); backdrop-filter:blur(8px); border-bottom:1px solid #1f2937; padding:12px 16px}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--me),#1e40af);box-shadow:0 8px 30px rgba(29,78,216,.25)}
    .title{margin:0;font-weight:800}
    .subtitle{margin:2px 0 0;font-size:13px;opacity:.85}
    .controls{margin-top:10px;display:flex;gap:8px;align-items:center}
    .btn{border:none;padding:8px 12px;border-radius:10px;background:var(--me);color:#fff;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #1f2937}
    .btn.warn{background:var(--warn)}
    .hud{display:flex;gap:10px;margin-top:10px;align-items:center}
    .stat{background:#0b152e;padding:6px 10px;border-radius:10px;border:1px solid #1f2937;font-size:13px}
    .progress{height:8px;background:#0f172a;border-radius:999px;margin-top:8px;overflow:hidden;border:1px solid #1f2937}
    .progress > span{display:block;height:100%;background:linear-gradient(90deg,#3b82f6,#06b6d4);width:0%}

    main.chat{max-width:980px;margin:12px auto;padding:18px 16px 120px;display:grid;gap:14px}
    .msg{width:fit-content;max-width:min(92%,760px);padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.04);box-shadow:0 12px 30px rgba(0,0,0,.35);background:var(--panel);opacity:0;transform:translateY(14px) scale(.985);filter:blur(4px);transition:opacity .42s ease,transform .42s cubic-bezier(.2,.7,.2,1),filter .42s ease;will-change:opacity,transform,filter}
    .msg.in-view{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}
    .from-me{margin-inline-start:auto;background:linear-gradient(180deg,var(--me),#1e40af);color:#fff;border-top-left-radius:10px;border-top-right-radius:4px}
    .from-them{margin-inline-end:auto;background:linear-gradient(180deg,var(--them),#1f2937);color:var(--text);border-top-left-radius:4px;border-top-right-radius:10px}

    .lesson{border-radius:12px;overflow:hidden;border:1px solid #1f2b48;background:linear-gradient(180deg,#07102a,#071428)}
    .lesson-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(180deg,#071428,#07102a);border-bottom:1px solid #0f1b38}
    .lesson-title{font-weight:800;color:#a5b4fc}
    .badge{background:#18264a;color:#9ec1ff;padding:6px 10px;border-radius:999px;font-size:13px}
    .lesson-body{padding:12px}
    .goal{font-size:13px;opacity:.95;margin:6px 0}
    .code-box{background:#071428;border-radius:10px;border:1px solid #0f1b38;margin-top:10px}
    .code-head{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:#071a3a;border-bottom:1px solid #0f1b38}
    .code-head .meta{font-size:13px;color:#93c5fd}
    pre{margin:0;padding:12px 14px;overflow:auto;color:#d7e3ff;background:transparent}
    .lined pre{counter-reset:line}
    .lined code{display:block}
    .lined code span{display:block;white-space:pre}
    .lined code span::before{counter-increment:line;content:counter(line);display:inline-block;width:3ch;margin-inline-end:10px;color:#7ea2ff;opacity:.7}

    .editor{margin-top:12px}
    textarea.editor-area{width:100%;height:160px;background:#071428;color:#d7e3ff;border-radius:10px;border:1px solid #0f1b38;padding:10px;font-family:ui-monospace,monospace;font-size:13px}
    .editor .row{display:flex;gap:8px;align-items:center;margin-top:8px}
    .result{margin-top:8px;font-size:13px}
    .result.ok{color:var(--ok)}
    .result.warn{color:var(--warn)}
    .result.bad{color:var(--bad)}

    .locked{opacity:.35;filter:grayscale(.2);position:relative}
    .locked::after{content:"Ù…Ù‚ÙÙˆÙ„";position:absolute;inset:10px;border-radius:10px;background:linear-gradient(90deg,rgba(2,6,23,.6),rgba(2,6,23,.6));display:flex;align-items:center;justify-content:center;color:#93c5fd;font-weight:800;font-size:14px}

    .quiz{padding:12px;border-radius:12px;background:#071428;border:1px solid #0f1b38}
    .q-item{margin:10px 0}
    .q-item .q{margin-bottom:8px}
    .q-item button{margin-inline-end:8px;margin-top:6px;background:#1d4ed8;color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
    .composer{position:fixed;inset-inline:0;bottom:0;display:flex;gap:8px;padding:10px 12px;background:rgba(8,12,24,.9);backdrop-filter:blur(8px);border-top:1px solid #0f2937}
    .composer input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:var(--panel2);color:var(--text);outline:none}
    .composer button{padding:10px 14px;border-radius:10px;border:none;background:var(--me);color:#fff;font-weight:700;cursor:pointer}

    .toast{position:fixed;bottom:84px;inset-inline:12px;z-index:40;display:none;padding:10px;border-radius:10px;background:#071428;border:1px solid #0f1b38}
    .levelup{position:fixed;top:12px;left:12px;z-index:40;display:none;padding:10px 14px;border-radius:12px;background:linear-gradient(90deg,#3b82f6,#06b6d4);color:#fff;font-weight:800;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    @media (max-width:720px){
      .lesson-body{padding:10px}
      pre{font-size:12px}
      textarea.editor-area{height:140px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div style="flex:1">
        <h1 class="title">Ù…Ù†ØµØ© Ø´Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© â€” ØªØ¹Ù„Ù… Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ (10 Ù…Ø³ØªÙˆÙŠØ§Øª)</h1>
        <p class="subtitle">Ø¯Ø±ÙˆØ³ Ø¹Ù…Ù„ÙŠØ©ØŒ Ù…Ø­Ø±Ø± ÙƒÙˆØ¯ØŒ Ø§Ù…ØªØ­Ø§Ù†Ø§ØªØŒ Ù†Ù‚Ø§Ø· ÙˆØ´Ø§Ø±Ø§Øª â€” ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯</p>

        <div class="controls">
          <button class="btn" id="resetBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…</button>
          <button class="btn ghost" id="exportBtn">Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ©</button>
          <div style="flex:1"></div>
          <div class="hud">
            <div class="stat">Ù†Ù‚Ø§Ø·: <strong id="score">0</strong></div>
            <div class="stat">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <strong id="level">1</strong> / 10</div>
            <div class="stat">Ø´Ø§Ø±Ø§Øª: <strong id="badges">â€”</strong></div>
          </div>
        </div>

        <div class="progress" aria-hidden="true"><span id="progressBar"></span></div>
      </div>
    </div>
  </header>

  <div class="levelup" id="levelup"></div>
  <div class="toast" id="toast"></div>

  <main class="chat" id="chat" role="main" aria-live="polite"></main>

  <footer class="composer" role="contentinfo">
    <input id="input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ ØªØ¹Ù„ÙŠÙ‚Ùƒ..." />
    <button id="send">Ø¥Ø±Ø³Ø§Ù„</button>
  </footer>

  <script>
    /*************************************************************************
     * Ù…Ù†ØµØ© Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ ØªÙØ§Ø¹Ù„ÙŠØ© â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯
     * Ù…ÙŠØ²Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:
     * - Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø±Ø± Ù„ÙƒÙ„ Ø¯Ø±Ø³
     * - Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù…
     * - ÙØªØ­ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù…Ø­Ø§ÙƒÙŠ Wokwi Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· Ù…Ø´ÙØ±
     * - Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ù‚ÙÙ„Ø© Ø­ØªÙ‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³
     * - Ù†Ù‚Ø§Ø· ÙˆØ´Ø§Ø±Ø§Øª ÙˆØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ
     *************************************************************************/

    // ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ù…Ù†Ø¸Ù…
    const STORAGE_KEY = 'arduino_platform_v3';
    function loadState(){
      try{
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {score:0,level:1,unlockedLevel:1,badges:[],completedLessons:{},editorContent:{}};
      }catch(e){
        return {score:0,level:1,unlockedLevel:1,badges:[],completedLessons:{},editorContent:{}};
      }
    }
    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    const state = loadState();

    // Ø¹Ù†Ø§ØµØ± DOM
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const badgesEl = document.getElementById('badges');
    const progressBar = document.getElementById('progressBar');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');
    const levelupEl = document.getElementById('levelup');
    const toastEl = document.getElementById('toast');

    function updateHUD(){
      scoreEl.textContent = state.score;
      levelEl.textContent = state.level;
      badgesEl.textContent = state.badges.length ? state.badges.join('ØŒ ') : 'â€”';
      progressBar.style.width = Math.min(((state.unlockedLevel-1)/9)*100,100) + '%';
      saveState();
    }

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.style.display = 'block';
      setTimeout(()=> toastEl.style.display='none', 1600);
    }

    function levelUp(newLevel){
      levelupEl.textContent = `ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${newLevel} ğŸ‰`;
      levelupEl.style.display = 'block';
      setTimeout(()=> levelupEl.style.display='none', 1600);
    }

    // Ø­Ø±ÙƒØ© Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¹Ù…Ø©
    const observer = new IntersectionObserver((entries)=>{
      for(const e of entries){
        if(e.isIntersecting){ e.target.classList.add('in-view'); observer.unobserve(e.target); }
      }
    }, {threshold:.12, rootMargin:'0px 0px -8% 0px'});

    // Ø¯Ø±ÙˆØ³ ÙˆÙ…Ø­ØªÙˆÙ‰ (10 Ù…Ø³ØªÙˆÙŠØ§Øª)
    const lessons = [
      { id:'L1', level:1, title:'ØªØ´ØºÙŠÙ„ LED â€” Ø£Ø³Ø§Ø³ÙŠØ§Øª', goals:['pinMode Ùˆ digitalWrite','delay Ù„Ù„ØªØ£Ø®ÙŠØ±','Ù…Ø®Ø±Ø¬ 13 ÙˆØ§Ù„Ù€ LED Ø§Ù„Ù…Ø¯Ù…Ø¬'], tokens:['pinMode','digitalWrite','delay','13'], code:`void setup(){ pinMode(13, OUTPUT); }\nvoid loop(){ digitalWrite(13, HIGH); delay(1000); digitalWrite(13, LOW); delay(1000); }`, tips:'Ø§Ù„Ù€ LED Ø§Ù„Ù…Ø¯Ù…Ø¬ ØºØ§Ù„Ø¨Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø®Ø±Ø¬ 13.' },
      { id:'L2', level:2, title:'Ø²Ø± + LED â€” INPUT_PULLUP', goals:['INPUT_PULLUP','digitalRead','ØªØ´ØºÙŠÙ„ LED Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©'], tokens:['INPUT_PULLUP','digitalRead','pinMode','const int'], code:`const int BTN=2; const int LED=13;\nvoid setup(){ pinMode(BTN, INPUT_PULLUP); pinMode(LED, OUTPUT); }\nvoid loop(){ int pressed = (digitalRead(BTN)==LOW); digitalWrite(LED, pressed ? HIGH : LOW); }`, tips:'Ø§Ù„Ø²Ø± Ù„Ù„Ø£Ø±Ø¶ÙŠ ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¶ØºØ· = LOW.' },
      { id:'L3', level:3, title:'Ø­Ø³Ø§Ø³ LM35 â€” Ù‚Ø±Ø§Ø¡Ø© analog', goals:['analogRead','ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ÙÙˆÙ„Øª ÙˆØ¯Ø±Ø¬Ø©','Serial.print'], tokens:['analogRead','Serial.begin','Serial.println','A0'], code:`const int AIN=A0;\nvoid setup(){ Serial.begin(9600); }\nvoid loop(){ int raw=analogRead(AIN); float v=(raw*5.0)/1023.0; float t=v*100.0; Serial.print("Temp C: "); Serial.println(t,1); delay(500); }`, tips:'ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø±Ø¬Ø¹ 5V Ù…Ø³ØªÙ‚Ø±.' },
      { id:'L4', level:4, title:'PWM Ù„Ù„Ù…ÙˆØªÙˆØ± â€” L298N', goals:['analogWrite','Ø¯ÙˆØ§Ù„ Ø­Ø±ÙƒØ©','Ù…Ø²ÙˆØ¯ Ø·Ø§Ù‚Ø© Ù…Ù†ÙØµÙ„'], tokens:['analogWrite','HIGH','LOW','int'], code:`const int IN1=8, IN2=9, ENA=10;\nvoid setup(){ pinMode(IN1,OUTPUT); pinMode(IN2,OUTPUT); pinMode(ENA,OUTPUT); }\nvoid forward(int spd){ digitalWrite(IN1,HIGH); digitalWrite(IN2,LOW); analogWrite(ENA, spd); }\nvoid backward(int spd){ digitalWrite(IN1,LOW); digitalWrite(IN2,HIGH); analogWrite(ENA, spd); }\nvoid stopMotor(){ analogWrite(ENA,0); digitalWrite(IN1,LOW); digitalWrite(IN2,LOW); }\nvoid loop(){ forward(180); delay(1200); stopMotor(); delay(500); backward(160); delay(1200); stopMotor(); delay(700); }`, tips:'Ø§Ø³ØªØ®Ø¯Ù… Ù…Ø²ÙˆØ¯ Ø·Ø§Ù‚Ø© Ù…Ù†ÙØµÙ„ Ù„Ù„Ù…ÙˆØªÙˆØ±.' },
      { id:'L5', level:5, title:'LCD 16x2 â€” LiquidCrystal', goals:['lcd.begin','lcd.print','lcd.setCursor'], tokens:['#include <LiquidCrystal.h>','lcd.begin','lcd.print','lcd.setCursor'], code:`#include <LiquidCrystal.h>\nLiquidCrystal lcd(12,11,5,4,3,2);\nvoid setup(){ lcd.begin(16,2); lcd.print("Hello, Yasser!"); }\nvoid loop(){ lcd.setCursor(0,1); lcd.print(millis()/1000); delay(250); }`, tips:'Ø§Ø¶Ø¨Ø· Ù…Ù‚Ø§ÙˆÙ…Ø© Ø§Ù„ÙƒÙˆÙ†ØªØ±Ø§Ø³Øª.' },
      { id:'L6', level:6, title:'Servo SG90 â€” Ø²Ø§ÙˆÙŠØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ©', goals:['Ù…ÙƒØªØ¨Ø© Servo','write Ù„Ù„Ø­Ø±ÙƒØ©','Ø­Ù„Ù‚Ø© Ù…Ø³Ø­'], tokens:['#include <Servo.h>','Servo','attach','write'], code:`#include <Servo.h>\nServo s;\nvoid setup(){ s.attach(9); }\nvoid sweep(int a,int b,int step){ if(a<b){ for(int x=a;x<=b;x+=step){ s.write(x); delay(12);} } else{ for(int x=a;x>=b;x-=step){ s.write(x); delay(12);} } }\nvoid loop(){ sweep(0,180,3); delay(300); sweep(180,0,3); delay(300); }`, tips:'Ù„Ø§ ØªØ³Ø­Ø¨ ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ±ÙÙˆ Ù…Ù† Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ Ø¥Ø°Ø§ Ø§Ù„Ø­Ù…Ù„ ÙƒØ¨ÙŠØ±.' },
      { id:'L7', level:7, title:'Serial Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ â€” Ø£ÙˆØ§Ù…Ø±', goals:['Serial.available','Ù‚Ø±Ø§Ø¡Ø© Ø£ÙˆØ§Ù…Ø±','Ø±Ø¯ÙˆØ¯ Ø¹Ø¨Ø± Serial'], tokens:['Serial.available','Serial.readString','Serial.parseInt','switch'], code:`void setup(){ Serial.begin(9600); pinMode(13,OUTPUT); }\nvoid loop(){ if(Serial.available()){ String cmd = Serial.readString(); cmd.trim(); if(cmd=="LEDON"){ digitalWrite(13, HIGH); Serial.println("LED ON"); } else if(cmd=="LEDOFF"){ digitalWrite(13, LOW); Serial.println("LED OFF"); } else{ Serial.println("Unknown"); } } delay(10); }`, tips:'Ø§Ø³ØªØ®Ø¯Ù… Serial Monitor Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆØ§Ù…Ø±.' },
      { id:'L8', level:8, title:'I2C â€” Ù‚Ø±Ø§Ø¡Ø© Ù…Ø«Ø§Ù„ Ø¹Ø§Ù…', goals:['Wire.begin','requestFrom','Wire.read'], tokens:['#include <Wire.h>','Wire.begin','Wire.requestFrom','Wire.read'], code:`#include <Wire.h>\nconst byte DEV=0x48;\nvoid setup(){ Wire.begin(); Serial.begin(9600); }\nvoid loop(){ Wire.beginTransmission(DEV); Wire.write(0x00); Wire.endTransmission(); Wire.requestFrom(DEV, 1); if(Wire.available()){ byte val = Wire.read(); Serial.print("Raw: "); Serial.println(val); } delay(500); }`, tips:'ØºÙŠÙ‘Ø± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ´Ø¹Ø±.' },
      { id:'L9', level:9, title:'SPI â€” Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø³ØªÙ‚Ø¨Ø§Ù„', goals:['SPI.begin','SPI.transfer','CS control'], tokens:['#include <SPI.h>','SPI.begin','SPI.transfer','pinMode'], code:`#include <SPI.h>\nconst int CS=10;\nvoid setup(){ Serial.begin(9600); pinMode(CS,OUTPUT); digitalWrite(CS,HIGH); SPI.begin(); }\nbyte sendRecv(byte data){ digitalWrite(CS,LOW); byte r = SPI.transfer(data); digitalWrite(CS,HIGH); return r; }\nvoid loop(){ byte r = sendRecv(0xA5); Serial.print("Recv: "); Serial.println(r, HEX); delay(500); }`, tips:'ÙˆØµÙ„ MOSI/MISO/SCK/CS Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙŠÙØ§ÙŠØ³.' },
      { id:'L10', level:10, title:'Ù…Ø´Ø±ÙˆØ¹ ØªØ¬Ù…ÙŠØ¹ÙŠ â€” Ø³ÙŠØ§Ø±Ø© Ø¨Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ø¨Ø± Serial', goals:['Ø¯Ù…Ø¬ PWM Ù…Ø¹ Ø£ÙˆØ§Ù…Ø± Serial','Ø£ÙˆØ§Ù…Ø± F/B/L/R/S','Ù‚Ø§Ø¨Ù„ÙŠØ© ØªÙˆØ³Ø¹Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹'], tokens:['analogWrite','Serial','if','else if'], code:`const int IN1L=8, IN2L=9, ENAL=10;\nconst int IN1R=6, IN2R=7, ENAR=5;\nvoid setup(){ Serial.begin(9600); pinMode(IN1L,OUTPUT); pinMode(IN2L,OUTPUT); pinMode(ENAL,OUTPUT); pinMode(IN1R,OUTPUT); pinMode(IN2R,OUTPUT); pinMode(ENAR,OUTPUT); }\nvoid drive(int lspd,int rspd){ analogWrite(ENAL, abs(lspd)); analogWrite(ENAR, abs(rspd)); digitalWrite(IN1L, lspd>=0 ? HIGH:LOW); digitalWrite(IN2L, lspd>=0 ? LOW:HIGH); digitalWrite(IN1R, rspd>=0 ? HIGH:LOW); digitalWrite(IN2R, rspd>=0 ? LOW:HIGH); }\nvoid stopAll(){ analogWrite(ENAL,0); analogWrite(ENAR,0); digitalWrite(IN1L,LOW); digitalWrite(IN2L,LOW); digitalWrite(IN1R,LOW); digitalWrite(IN2R,LOW); }\nvoid loop(){ if(Serial.available()){ String cmd = Serial.readString(); cmd.trim(); int spd = 160; if(cmd.startsWith("SPD")){ spd = cmd.substring(3).toInt(); spd = constrain(spd, 0, 255); Serial.print("SPD="); Serial.println(spd); } else if(cmd=="F"){ drive(spd, spd); Serial.println("Forward"); } else if(cmd=="B"){ drive(-spd,-spd); Serial.println("Backward"); } else if(cmd=="L"){ drive(-spd, spd); Serial.println("Left"); } else if(cmd=="R"){ drive(spd,-spd); Serial.println("Right"); } else if(cmd=="S"){ stopAll(); Serial.println("Stop"); } else { Serial.println("Unknown"); } } delay(5); }`, tips:'Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø¹Ø¨Ø± Serial Monitor.' }
    ];

    // Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
    const quizzes = [
      { title:'Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3', cover:[1,2,3], questions:[
        {q:'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø®Ø±Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù€ LED Ø§Ù„Ù…Ø¯Ù…Ø¬ØŸ', opts:['13','A0','2','10'], ans:0},
        {q:'Ù…Ø§ ÙˆØ¸ÙŠÙØ© INPUT_PULLUPØŸ', opts:['ØªØ´ØºÙŠÙ„ PWM','Ù…Ù‚Ø§ÙˆÙ…Ø© Ø³Ø­Ø¨ Ø¯Ø§Ø®Ù„ÙŠØ©','Ø·Ø¨Ø§Ø¹Ø© Ù†Øµ','Ù‚Ø±Ø§Ø¡Ø© SPI'], ans:1},
        {q:'Ø¯Ù‚Ø© analogRead ÙÙŠ Ø£ÙˆÙ†ÙˆØŸ', opts:['8-Ø¨Øª','10-Ø¨Øª','12-Ø¨Øª','16-Ø¨Øª'], ans:1}
      ]},
      { title:'Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 6', cover:[4,5,6], questions:[
        {q:'Ø£ÙŠ Ø¯Ø§Ù„Ø© ØªÙˆÙ„Ø¯ PWMØŸ', opts:['digitalWrite','analogRead','analogWrite','Serial.print'], ans:2},
        {q:'Ù…ÙƒØªØ¨Ø© Ø´Ø§Ø´Ø© LCDØŸ', opts:['Servo','LiquidCrystal','Wire','SPI'], ans:1},
        {q:'Ø¯Ø§Ù„Ø© ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³ÙŠØ±ÙÙˆØŸ', opts:['write','print','transfer','setCursor'], ans:0}
      ]},
      { title:'Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 9', cover:[7,8,9], questions:[
        {q:'Ù‚Ø±Ø§Ø¡Ø© Ù†Øµ Ù…Ù† SerialØŸ', opts:['Serial.readString','Wire.read','SPI.transfer','analogRead'], ans:0},
        {q:'Ù…ÙƒØªØ¨Ø© I2CØŸ', opts:['SPI','Wire','Servo','EEPROM'], ans:1},
        {q:'Ù…ÙƒØªØ¨Ø© SPIØŸ', opts:['LiquidCrystal','Servo','SPI','Wire'], ans:2}
      ]},
      { title:'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', cover:[10], questions:[
        {q:'Ø£Ù…Ø± Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ', opts:['F','B','S','R'], ans:2},
        {q:'ÙƒÙŠÙ ØªØ­Ø¯Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©ØŸ', opts:['Ø£Ù…Ø± SPDxxx','Ø£Ù…Ø± LEDON','Ø£Ù…Ø± LCD','Ø£Ù…Ø± I2C'], ans:0},
        {q:'Ù‚ÙŠÙ… PWM Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§ØŸ', opts:['0â€“255','0â€“1023','0â€“10','0â€“1'], ans:0}
      ]}
    ];

    // Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
    function escapeHTML(str){ return str.replace(/[&<>"']/g, ch=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[ch])); }

    // ÙØªØ­ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Wokwi (ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©)
    function openInWokwi(code){
      try{
        const base = 'https://wokwi.com/arduino/new?sketch=';
        const url = base + encodeURIComponent(code);
        window.open(url, '_blank');
      }catch(e){
        toast('ØªØ¹Ø°Ø± ÙØªØ­ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ');
      }
    }

    // Ø¹Ø±Ø¶ Ø¯Ø±Ø³ ÙˆØ§Ø­Ø¯
    function renderLesson(lesson){
      const locked = lesson.level > state.unlockedLevel;
      const wrap = document.createElement('div'); wrap.className = 'lesson msg from-them' + (locked ? ' locked' : '');
      const head = document.createElement('div'); head.className = 'lesson-head';
      head.innerHTML = `<div style="display:flex;gap:10px;align-items:center"><span class="badge">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${lesson.level}</span><div class="lesson-title">${lesson.title}</div></div>
                        <div style="display:flex;gap:8px;align-items:center">
                          <button class="btn ghost" data-id="${lesson.id}">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³</button>
                          <button class="btn ghost" data-run="${lesson.id}">ÙØªØ­ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ</button>
                        </div>`;
      const body = document.createElement('div'); body.className = 'lesson-body';
      // Ø£Ù‡Ø¯Ø§Ù
      lesson.goals.forEach(g=>{
        const p = document.createElement('div'); p.className='goal'; p.textContent = 'â€¢ ' + g; body.appendChild(p);
      });
      // ÙƒÙˆØ¯ Ø¬Ø§Ù‡Ø²
      const codeBox = document.createElement('div'); codeBox.className='code-box lined';
      const codeHead = document.createElement('div'); codeHead.className='code-head';
      codeHead.innerHTML = `<div class="meta">ÙƒÙˆØ¯ ØªØ¬Ø±ÙŠØ¨ÙŠ</div><div class="meta"></div>`;
      const pre = document.createElement('pre');
      const numbered = lesson.code.split('\n').map(l=>`<span>${escapeHTML(l)}</span>`).join('\n');
      pre.innerHTML = `<code>${numbered}</code>`;
      codeBox.appendChild(codeHead); codeBox.appendChild(pre);
      body.appendChild(codeBox);

      // Ù…Ø­Ø±Ø± Ø§Ù„Ø·Ø§Ù„Ø¨
      const editor = document.createElement('div'); editor.className='editor';
      const ta = document.createElement('textarea'); ta.className='editor-area'; ta.placeholder='Ø§ÙƒØªØ¨ ÙƒÙˆØ¯Ùƒ Ù‡Ù†Ø§...';
      // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø­ØªÙˆÙ‰ Ù…Ø­ÙÙˆØ¸
      const saved = state.editorContent[lesson.id];
      if(saved) ta.value = saved;
      // Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ
      ta.addEventListener('input', ()=>{ state.editorContent[lesson.id] = ta.value; saveState(); });

      const row = document.createElement('div'); row.className='row';
      const checkBtn = document.createElement('button'); checkBtn.className='btn'; checkBtn.textContent='ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯';
      const hintBtn = document.createElement('button'); hintBtn.className='btn ghost'; hintBtn.textContent='ØªÙ„Ù…ÙŠØ­Ø§Øª';
      const openBtn = document.createElement('button'); openBtn.className='btn secondary'; openBtn.textContent='ÙØªØ­ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ';
      openBtn.style.background = '#06b6d4'; openBtn.style.color = '#022';
      row.appendChild(checkBtn); row.appendChild(hintBtn); row.appendChild(openBtn);

      const result = document.createElement('div'); result.className='result';

      hintBtn.onclick = ()=>{ result.className='result warn'; result.textContent = 'ØªÙ„Ù…ÙŠØ­: ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª: ' + lesson.tokens.join(', '); };

      checkBtn.onclick = ()=>{
        const txt = ta.value || '';
        if(!txt.trim()){ result.className='result.bad'; result.textContent='Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±.'; return; }
        const missing = lesson.tokens.filter(t=>{
          const re = new RegExp('\\b' + t.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\$&') + '\\b', 'i');
          return !re.test(txt);
        });
        if(missing.length===0){
          result.className='result ok'; result.textContent='Ù…Ù…ØªØ§Ø²! Ø§Ù„ÙƒÙˆØ¯ ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© âœ…';
          // Ù…Ù†Ø­ Ù†Ù‚Ø§Ø· Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
          if(!state.completedLessons[lesson.id]){
            state.completedLessons[lesson.id] = true;
            state.score += 12; // Ù†Ù‚Ø§Ø· ØªØ­Ù‚Ù‚
            // ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø¢Ø®Ø± Ø¯Ø±Ø³ Ù…ÙØªÙˆØ­
            if(state.unlockedLevel <= lesson.level && lesson.level < 10){
              state.unlockedLevel = lesson.level + 1;
              levelUp(state.unlockedLevel);
            }
            // Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø¹Ø§Ù… Ø¥Ù† ÙƒØ§Ù† Ù…Ù†Ø§Ø³Ø¨
            if(state.level < lesson.level) state.level = lesson.level;
            saveState(); updateHUD();
            toast('+12 Ù†Ù‚Ø§Ø· â€” Ø¯Ø±Ø³ Ù…ÙƒØªÙ…Ù„');
          } else {
            toast('ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø³Ø¨Ù‚Ù‹Ø§');
          }
        } else {
          result.className='result.warn'; result.textContent = 'Ù†ÙˆØ§Ù‚Øµ: ' + missing.join(', ');
        }
      };

      openBtn.onclick = ()=> openInWokwi(ta.value || lesson.code);
      // Ø²Ø± ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø± Ù„ÙØªØ­ Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
      head.querySelector('[data-run]')?.addEventListener('click', ()=> openInWokwi(lesson.code));

      editor.appendChild(ta); editor.appendChild(row); editor.appendChild(result);
      body.appendChild(editor);

      wrap.appendChild(head); wrap.appendChild(body);
      chat.appendChild(wrap);
      observer.observe(wrap);

      // Ø²Ø± Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
      head.querySelector('[data-id]')?.addEventListener('click', ()=>{
        if(!state.completedLessons[lesson.id]){
          state.completedLessons[lesson.id] = true;
          state.score += 6;
          if(state.unlockedLevel <= lesson.level && lesson.level < 10) state.unlockedLevel = lesson.level + 1;
          if(state.level < lesson.level) state.level = lesson.level;
          saveState(); updateHUD();
          toast('ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ +6 Ù†Ù‚Ø§Ø·');
        } else {
          toast('Ø§Ù„Ø¯Ø±Ø³ Ù…ÙƒØªÙ…Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
        }
      });
    }

    // Ø¹Ø±Ø¶ Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¹ Ù‚ÙÙ„ Ø­ØªÙ‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØºØ·Ø§Ø©
    function renderQuiz(quiz){
      const requiredLevels = quiz.cover;
      const allDone = requiredLevels.every(lv => lessons.some(ls => ls.level===lv && state.completedLessons[ls.id]));
      const box = document.createElement('div'); box.className='quiz msg from-them' + (allDone ? '' : ' locked');
      const h = document.createElement('h3'); h.textContent = quiz.title; box.appendChild(h);
      const info = document.createElement('div'); info.style.marginBottom='8px'; info.textContent = allDone ? 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø§Ù‡Ø²' : 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„ÙØªØ­ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†'; box.appendChild(info);

      const answers = [];
      quiz.questions.forEach((q, idx)=>{
        const item = document.createElement('div'); item.className='q-item';
        const qdiv = document.createElement('div'); qdiv.className='q'; qdiv.textContent = `Ø³${idx+1}: ${q.q}`; item.appendChild(qdiv);
        q.opts.forEach((opt, j)=>{
          const btn = document.createElement('button'); btn.textContent = opt;
          btn.onclick = ()=>{
            if(!allDone){ toast('Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ù‚ÙÙˆÙ„ Ø­ØªÙ‰ ØªÙƒÙ…Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³'); return; }
            if(btn.disabled) return;
            const siblings = item.querySelectorAll('button'); siblings.forEach(b=> b.disabled=true);
            answers[idx] = j;
            if(j === q.ans) btn.style.background = '#22c55e'; else btn.style.background = '#ef4444';
          };
          item.appendChild(btn);
        });
        box.appendChild(item);
      });

      const submit = document.createElement('button'); submit.className='btn'; submit.textContent='ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†';
      submit.onclick = ()=>{
        if(!allDone){ toast('Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù…Ù‚ÙÙˆÙ„'); return; }
        const correct = quiz.questions.reduce((acc,q,i)=> acc + ((answers[i] === q.ans) ? 1 : 0), 0);
        const gain = correct * 10;
        state.score += gain;
        // Ø´Ø±Ø· Ø§Ù„Ù†Ø¬Ø§Ø­: 60% Ø£Ùˆ Ø£ÙƒØ«Ø±
        const pass = correct >= Math.ceil(quiz.questions.length * 0.6);
        if(pass){
          const badge = `Ø´Ø§Ø±Ø© ${quiz.title}`;
          if(!state.badges.includes(badge)) state.badges.push(badge);
          // ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ø£Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ù…ØºØ·Ù‰ + 1)
          const maxLevel = Math.max(...quiz.cover);
          if(state.unlockedLevel <= maxLevel) state.unlockedLevel = maxLevel + 1;
          toast(`Ø§Ø¬ØªØ²Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†! +${gain} Ù†Ù‚Ø§Ø· â€” ${badge}`);
        } else {
          toast(`Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ù†Ù‚Ø§Ø· +${gain}`);
        }
        saveState(); updateHUD();
      };
      box.appendChild(submit);
      chat.appendChild(box);
      observer.observe(box);
    }

    // Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ù‚ÙÙ„/ÙØªØ­
    function renderAll(){
      addMsg('Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø±Ø¯ÙˆÙŠÙ†Ùˆ â€” Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1 ÙˆØªØ¯Ø±Ø¬ Ø­ØªÙ‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 10','them');
      lessons.forEach((ls, idx)=>{
        renderLesson(ls);
        // Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø±Ø³ 3ØŒ6ØŒ9 Ø£Ø¶Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
        if(ls.level === 3) renderQuiz(quizzes[0]);
        if(ls.level === 6) renderQuiz(quizzes[1]);
        if(ls.level === 9) renderQuiz(quizzes[2]);
        if(ls.level === 10) renderQuiz(quizzes[3]);
      });
      addMsg('Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ ÙˆØ³Ù†Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§','them');
    }

    // Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©
    function addMsg(text, from='them'){
      const el = document.createElement('div'); el.className = `msg from-${from}`; el.textContent = text;
      chat.appendChild(el); observer.observe(el);
      return el;
    }

    // Ø´Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function addUserMessage(text){
      const el = document.createElement('div'); el.className='msg from-me'; el.textContent = text;
      chat.appendChild(el); observer.observe(el); el.scrollIntoView({behavior:'smooth', block:'end'});
      setTimeout(()=> addMsg('Ø³Ø¤Ø§Ù„ Ø¬ÙŠØ¯! Ø¬Ø±Ù‘Ø¨ ØªÙ†ÙÙŠØ° Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø± Ø£Ùˆ Ø§Ø°ÙƒØ± Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠÙ‡','them'), 700);
    }

    // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
    resetBtn.addEventListener('click', ()=>{
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø§Ù„ØªÙ‚Ø¯Ù‘Ù…ØŸ')) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
      }
    });

    // Ø²Ø± ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© (ÙŠØ­ÙØ¸ JSON ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù†Ø³Ø®)
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const w = window.open('', '_blank');
      w.document.body.style.background = '#071428';
      w.document.body.style.color = '#d7e3ff';
      const pre = w.document.createElement('pre'); pre.textContent = data; pre.style.whiteSpace='pre-wrap'; pre.style.padding='12px';
      w.document.body.appendChild(pre);
    });

    // Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† composer
    sendBtn.addEventListener('click', ()=>{
      const t = input.value.trim(); if(!t) return; addUserMessage(t); input.value='';
    });
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') sendBtn.click(); });

    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ø¥Ø³Ù‚Ø§Ø· Ø§Ù„Ø¹Ø±Ø¶ Ù„Ø¢Ø®Ø± Ø¹Ù†ØµØ±
    const mo = new MutationObserver(()=> {
      const last = chat.lastElementChild; if(last) last.scrollIntoView({behavior:'smooth', block:'end'});
    });
    mo.observe(chat, {childList:true});

    // Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø±Ø¶
    updateHUD();
    renderAll();

    // ØªØ£Ø®ÙŠØ± Ù…ÙˆØ¬ÙŠ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£ÙˆÙ„Ù‰
    const styleDelay = document.createElement('style');
    styleDelay.textContent = `.msg:nth-child(1){transition-delay:40ms}.msg:nth-child(2){transition-delay:80ms}.msg:nth-child(3){transition-delay:120ms}.msg:nth-child(4){transition-delay:160ms}.msg:nth-child(5){transition-delay:200ms}`;
    document.head.appendChild(styleDelay);
  </script>
</body>
</html>
