<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>دروس إضافية أردوينو — مستويات 11 إلى 20</title>
  <meta name="description" content="ملف واحد يحتوي دروس أردوينو متقدمة (L11-L20) مع كود جاهز، أهداف، تلميحات، وأزرار نسخ وفتح في المحاكي." />
  <style>
    :root{
      --bg:#0f172a; --panel:#0b1224; --card:#071428; --accent:#1d4ed8; --muted:#93c5fd; --text:#e5e7eb; --ok:#22c55e;
      --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, "Segoe UI", Tahoma, Arial, "Noto Naskh Arabic", sans-serif;
      background: radial-gradient(900px 480px at 70% -10%, #142045 0%, var(--bg) 60%), var(--bg);
      color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      line-height:1.6; padding-bottom:40px;
    }
    header{
      position:sticky; top:0; z-index:40; background:rgba(6,10,20,.75); backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,.04); padding:12px 16px;
    }
    .brand{display:flex; gap:12px; align-items:center; max-width:1100px; margin:0 auto}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);box-shadow:0 8px 30px rgba(29,78,216,.18)}
    .title{margin:0}
    .subtitle{margin:2px 0 0; font-size:13px; opacity:.85}
    .container{max-width:1100px;margin:18px auto;padding:0 16px; display:grid; grid-template-columns: 320px 1fr; gap:18px; align-items:start}
    /* Sidebar / TOC */
    .toc{position:sticky; top:86px; align-self:start; background:linear-gradient(180deg,#071428,#07102a); border:1px solid #0f1b38; padding:12px; border-radius:12px}
    .toc h3{margin:0 0 8px; color:var(--muted)}
    .toc ul{list-style:none; padding:0; margin:0; display:grid; gap:6px}
    .toc a{display:block; padding:8px 10px; border-radius:8px; color:var(--text); text-decoration:none; background:transparent; border:1px solid transparent}
    .toc a:hover{background:rgba(255,255,255,.02); border-color:rgba(255,255,255,.03)}
    /* Lessons list */
    .lessons{display:grid; gap:14px}
    .lesson{background:linear-gradient(180deg,#071428,#07102a); border:1px solid #0f1b38; border-radius:12px; overflow:hidden; padding:12px}
    .lesson-head{display:flex; justify-content:space-between; gap:12px; align-items:center}
    .lesson-title{font-weight:800; color:#a5b4fc}
    .badge{background:#18264a;color:#9ec1ff;padding:6px 10px;border-radius:999px;font-size:13px}
    .goals, .tokens{margin-top:10px; display:grid; gap:6px}
    .goal, .token{background:rgba(255,255,255,.02); padding:8px 10px; border-radius:8px; font-size:14px}
    .code-box{margin-top:12px; border-radius:10px; overflow:hidden; border:1px solid #0f1b38; background:var(--card)}
    .code-head{display:flex; justify-content:space-between; align-items:center; padding:8px 10px; background:linear-gradient(180deg,#071a3a,#071428); border-bottom:1px solid #0f1b38}
    .code-head .meta{font-size:13px; color:var(--muted)}
    .code-body{padding:10px; max-height:360px; overflow:auto; background:transparent}
    pre{margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace; font-size:13px; color:#d7e3ff; white-space:pre; line-height:1.45}
    /* numbered lines */
    .lined code{display:block}
    .lined code span{display:block; white-space:pre}
    .lined code span::before{counter-increment:line; content:counter(line); display:inline-block; width:3ch; margin-inline-end:10px; color:#7ea2ff; opacity:.8}
    .controls{display:flex; gap:8px; align-items:center}
    .btn{border:none; padding:8px 12px; border-radius:8px; background:var(--accent); color:#fff; font-weight:700; cursor:pointer}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,.04)}
    .btn.secondary{background:#06b6d4; color:#022}
    .tip{margin-top:10px; font-size:13px; color:#c7d2fe}
    /* footer composer */
    .composer{position:fixed; inset-inline:0; bottom:0; display:flex; gap:8px; padding:10px 16px; background:rgba(6,10,20,.9); border-top:1px solid rgba(255,255,255,.03); align-items:center}
    .composer input{flex:1; padding:10px 12px; border-radius:10px; border:1px solid #0f1b38; background:#071428; color:var(--text)}
    .iframe-modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:60}
    .iframe-modal .panel{width:90%; max-width:980px; height:80%; background:#000; border-radius:10px; overflow:hidden; border:1px solid #0f1b38}
    .iframe-modal .panel header{display:flex; justify-content:space-between; align-items:center; padding:8px 12px; background:#071428; color:var(--text)}
    .iframe-modal iframe{width:100%; height:calc(100% - 44px); border:0}
    /* responsive */
    @media (max-width:980px){
      .container{grid-template-columns: 1fr; padding:0 12px}
      .toc{position:static; order:2}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div style="flex:1">
        <h1 class="title">دروس إضافية — أردوينو (L11 → L20)</h1>
        <p class="subtitle">ملف واحد يحتوي الدروس، الكود، الأهداف، والتلميحات — انسخ الكود أو افتحه مباشرة في المحاكي</p>
      </div>
    </div>
  </header>

  <div class="container" role="main">
    <aside class="toc" aria-label="فهرس الدروس">
      <h3>فهرس الدروس</h3>
      <ul id="tocList"></ul>
      <div style="margin-top:10px; font-size:13px; color:var(--muted)">اضغط على عنوان للانتقال للدرس</div>
    </aside>

    <section class="lessons" id="lessonsList" aria-live="polite"></section>
  </div>

  <!-- Modal for embedded simulator -->
  <div class="iframe-modal" id="iframeModal" role="dialog" aria-hidden="true">
    <div class="panel" role="document">
      <header>
        <div id="iframeTitle">محاكي Wokwi</div>
        <div>
          <button class="btn ghost" id="closeIframe">إغلاق</button>
        </div>
      </header>
      <iframe id="simFrame" title="Wokwi Simulator"></iframe>
    </div>
  </div>

  <footer class="composer" aria-label="مربع البحث">
    <input id="searchInput" placeholder="ابحث عن درس أو كلمة مفتاحية (مثال: ESP8266, MQTT, NeoPixel)..." />
    <button class="btn" id="clearSearch">مسح</button>
  </footer>

  <script>
    // دروس إضافية (L11-L20)
    const extraLessons = [
      {
        id: 'L11',
        level: 11,
        title: 'ESP8266 WiFi Basic',
        goals: ['الاتصال بشبكة WiFi', 'طباعة عنوان IP على السيريال', 'فهم اختلافات ESP8266 عن أونو'],
        tokens: ['ESP8266WiFi', 'WiFi.begin', 'WiFi.status', 'Serial.begin'],
        code: `#include <ESP8266WiFi.h>
const char* ssid = "YOUR_SSID";
const char* pass = "YOUR_PASS";

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, pass);
  Serial.print("Connecting");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println();
  Serial.print("IP: ");
  Serial.println(WiFi.localIP());
}

void loop() {
  // هنا يمكنك إضافة منطق إرسال/استقبال عبر الشبكة
  delay(2000);
}`,
        tips: 'استبدل YOUR_SSID و YOUR_PASS. اختر لوحة ESP8266 في الـ IDE قبل الرفع.'
      },
      {
        id: 'L12',
        level: 12,
        title: 'MQTT بسيط مع PubSubClient',
        goals: ['الاتصال بـ MQTT Broker', 'نشر واشتراك برسائل', 'فهم موضوعات MQTT'],
        tokens: ['PubSubClient', 'client.publish', 'client.subscribe', 'WiFiClient'],
        code: `#include <ESP8266WiFi.h>
#include <PubSubClient.h>

const char* ssid = "YOUR_SSID";
const char* pass = "YOUR_PASS";
const char* mqttServer = "test.mosquitto.org";

WiFiClient espClient;
PubSubClient client(espClient);

void callback(char* topic, byte* payload, unsigned int length) {
  Serial.print("Message on ");
  Serial.print(topic);
  Serial.print(": ");
  for (int i=0;i<length;i++) Serial.print((char)payload[i]);
  Serial.println();
}

void setup() {
  Serial.begin(115200);
  WiFi.begin(ssid, pass);
  while (WiFi.status() != WL_CONNECTED) delay(200);
  client.setServer(mqttServer, 1883);
  client.setCallback(callback);
}

void loop() {
  if (!client.connected()) {
    client.connect("espClient");
    client.subscribe("test/topic");
  }
  client.loop();
  client.publish("test/topic", "hello from esp");
  delay(2000);
}`,
        tips: 'جرب broker عام مثل test.mosquitto.org قبل إعداد broker محلي.'
      },
      {
        id: 'L13',
        level: 13,
        title: 'NRF24L01 إرسال واستقبال',
        goals: ['تهيئة RF24', 'إرسال رسالة بسيطة', 'استقبال والتحقق من البيانات'],
        tokens: ['RF24', 'begin', 'openWritingPipe', 'write', 'available'],
        code: `#include <SPI.h>
#include <nRF24L01.h>
#include <RF24.h>

RF24 radio(9,10); // CE, CSN
const byte address[6] = "00001";

void setup() {
  Serial.begin(9600);
  radio.begin();
  radio.openWritingPipe(address);
  radio.setPALevel(RF24_PA_LOW);
}

void loop() {
  const char text[] = "Hello";
  radio.write(&text, sizeof(text));
  Serial.println("Sent");
  delay(1000);
}`,
        tips: 'تأكد من توصيل الطاقة بشكل جيد للموديول وشارك الأرضي مع الأردوينو.'
      },
      {
        id: 'L14',
        level: 14,
        title: 'Bluetooth HC-05 تواصل بسيط',
        goals: ['تهيئة SoftwareSerial', 'إرسال واستقبال نص عبر البلوتوث', 'فهم أوضاع HC-05'],
        tokens: ['SoftwareSerial', 'Serial', 'read', 'write'],
        code: `#include <SoftwareSerial.h>
SoftwareSerial bt(10, 11); // RX, TX

void setup() {
  Serial.begin(9600);
  bt.begin(9600);
  Serial.println("HC-05 ready");
}

void loop() {
  if (bt.available()) {
    char c = bt.read();
    Serial.write(c);
  }
  if (Serial.available()) {
    char c = Serial.read();
    bt.write(c);
  }
}`,
        tips: 'RX من HC-05 يذهب إلى TX الأردوينو عبر مقاومة مقسمة إذا لزم الأمر.'
      },
      {
        id: 'L15',
        level: 15,
        title: 'شاشة OLED I2C SSD1306',
        goals: ['تهيئة مكتبة SSD1306', 'عرض نص ورسم بسيط', 'استخدام I2C'],
        tokens: ['Adafruit_SSD1306', 'display.begin', 'display.print', 'Wire'],
        code: `#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire);

void setup() {
  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0,0);
  display.println("Hello OLED");
  display.display();
}

void loop() {
  // تحديثات عرض دورية
  delay(1000);
}`,
        tips: 'تحقق من عنوان I2C (0x3C أو 0x3D) باستخدام ماسح I2C.'
      },
      {
        id: 'L16',
        level: 16,
        title: 'EEPROM حفظ واسترجاع قيمة',
        goals: ['كتابة وقراءة بيانات صغيرة', 'فهم حدود دورات الكتابة', 'تخزين إعدادات بسيطة'],
        tokens: ['EEPROM.read', 'EEPROM.write', 'EEPROM.begin', 'EEPROM.commit'],
        code: `#include <EEPROM.h>

void setup() {
  Serial.begin(9600);
  EEPROM.begin(512); // للـ ESP، للأردوينو العادي لا تحتاج
  int val = EEPROM.read(0);
  Serial.print("Saved: ");
  Serial.println(val);
  EEPROM.write(0, 42);
  EEPROM.commit(); // للـ ESP
  Serial.println("Wrote 42");
}

void loop() { delay(1000); }`,
        tips: 'لا تكتب كثيرًا لتجنب استهلاك دورات الكتابة في EEPROM.'
      },
      {
        id: 'L17',
        level: 17,
        title: 'RTC DS3231 قراءة الوقت',
        goals: ['تهيئة مكتبة RTC', 'قراءة وعرض الوقت والتاريخ', 'ضبط الوقت إن لزم'],
        tokens: ['RTClib', 'RTC_DS3231', 'rtc.now', 'DateTime'],
        code: `#include <Wire.h>
#include "RTClib.h"

RTC_DS3231 rtc;

void setup() {
  Serial.begin(9600);
  if (!rtc.begin()) {
    Serial.println("Couldn't find RTC");
    while (1);
  }
  if (rtc.lostPower()) {
    rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));
  }
}

void loop() {
  DateTime now = rtc.now();
  Serial.print(now.year(), DEC);
  Serial.print('/');
  Serial.print(now.month(), DEC);
  Serial.print('/');
  Serial.print(now.day(), DEC);
  Serial.print(" ");
  Serial.print(now.hour(), DEC);
  Serial.print(':');
  Serial.print(now.minute(), DEC);
  Serial.print(':');
  Serial.println(now.second(), DEC);
  delay(1000);
}`,
        tips: 'تأكد من وجود بطارية للـ RTC للحفاظ على الوقت عند انقطاع الطاقة.'
      },
      {
        id: 'L18',
        level: 18,
        title: 'حساس مسافة HC-SR04',
        goals: ['قياس المسافة باستخدام pulseIn', 'حساب المسافة بالسنتيمتر', 'تجنب الضوضاء'],
        tokens: ['pulseIn', 'digitalWrite', 'pinMode', 'duration'],
        code: `const int trigPin = 9;
const int echoPin = 10;

void setup() {
  Serial.begin(9600);
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
}

void loop() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  long duration = pulseIn(echoPin, HIGH);
  float distanceCm = duration * 0.034 / 2;
  Serial.print("Distance: ");
  Serial.print(distanceCm);
  Serial.println(" cm");
  delay(300);
}`,
        tips: 'تأكد من أن الحساس لا يواجه أسطحًا تمتص الصوت أو تسبب ارتدادات غير متوقعة.'
      },
      {
        id: 'L19',
        level: 19,
        title: 'NeoPixel WS2812 تحكم بالألوان',
        goals: ['تهيئة مكتبة NeoPixel', 'تغيير ألوان LED فردي ومجموعة', 'فهم قيود الطاقة'],
        tokens: ['Adafruit_NeoPixel', 'setPixelColor', 'show', 'begin'],
        code: `#include <Adafruit_NeoPixel.h>
#define PIN 6
#define NUM 8
Adafruit_NeoPixel strip(NUM, PIN, NEO_GRB + NEO_KHZ800);

void setup() {
  strip.begin();
  strip.show();
}

void loop() {
  for (int i=0;i<NUM;i++){
    strip.setPixelColor(i, strip.Color(255,0,0));
    strip.show();
    delay(200);
  }
  for (int i=0;i<NUM;i++){
    strip.setPixelColor(i, strip.Color(0,0,0));
  }
  strip.show();
  delay(500);
}`,
        tips: 'استخدم مصدر طاقة منفصل للـ NeoPixels عند عدد كبير من الـ LEDs.'
      },
      {
        id: 'L20',
        level: 20,
        title: 'SD Card كتابة وقراءة ملف',
        goals: ['تهيئة مكتبة SD', 'فتح ملف للكتابة والقراءة', 'التعامل مع أخطاء الوسائط'],
        tokens: ['SD.begin', 'SD.open', 'File', 'file.close'],
        code: `#include <SPI.h>
#include <SD.h>

const int chipSelect = 4;

void setup() {
  Serial.begin(9600);
  if (!SD.begin(chipSelect)) {
    Serial.println("SD init failed");
    return;
  }
  File dataFile = SD.open("log.txt", FILE_WRITE);
  if (dataFile) {
    dataFile.println("Hello SD");
    dataFile.close();
    Serial.println("Wrote to log.txt");
  } else {
    Serial.println("Error opening file");
  }
}

void loop() { delay(1000); }`,
        tips: 'تأكد من توصيل CS بشكل صحيح واستخدم مستوى إشارة مناسب للـ SD (3.3V عادة).'
      }
    ];

    // Render TOC and lessons
    const tocList = document.getElementById('tocList');
    const lessonsList = document.getElementById('lessonsList');

    function makeTOCItem(lesson){
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + lesson.id;
      a.textContent = `المستوى ${lesson.level} — ${lesson.title}`;
      li.appendChild(a);
      return li;
    }

    function makeLessonCard(lesson){
      const wrap = document.createElement('article');
      wrap.className = 'lesson';
      wrap.id = lesson.id;

      const head = document.createElement('div');
      head.className = 'lesson-head';
      head.innerHTML = `<div style="display:flex;gap:10px;align-items:center"><span class="badge">المستوى ${lesson.level}</span><div class="lesson-title">${lesson.title}</div></div>`;

      const controls = document.createElement('div');
      controls.className = 'controls';
      const copyBtn = document.createElement('button');
      copyBtn.className = 'btn';
      copyBtn.textContent = 'نسخ الكود';
      copyBtn.setAttribute('aria-label', `نسخ كود ${lesson.id}`);
      const openBtn = document.createElement('button');
      openBtn.className = 'btn secondary';
      openBtn.textContent = 'فتح في المحاكي';
      openBtn.setAttribute('aria-label', `فتح ${lesson.id} في المحاكي`);
      controls.appendChild(copyBtn);
      controls.appendChild(openBtn);
      head.appendChild(controls);

      const body = document.createElement('div');
      body.className = 'lesson-body';

      // goals
      const goalsTitle = document.createElement('div');
      goalsTitle.style.marginTop = '8px';
      goalsTitle.style.color = 'var(--muted)';
      goalsTitle.textContent = 'الأهداف';
      body.appendChild(goalsTitle);
      const goals = document.createElement('div'); goals.className = 'goals';
      lesson.goals.forEach(g=>{
        const d = document.createElement('div'); d.className = 'goal'; d.textContent = g; goals.appendChild(d);
      });
      body.appendChild(goals);

      // tokens
      const tokensTitle = document.createElement('div');
      tokensTitle.style.marginTop = '8px';
      tokensTitle.style.color = 'var(--muted)';
      tokensTitle.textContent = 'كلمات مفتاحية للفحص';
      body.appendChild(tokensTitle);
      const tokens = document.createElement('div'); tokens.className = 'tokens';
      lesson.tokens.forEach(t=>{
        const d = document.createElement('div'); d.className = 'token'; d.textContent = t; tokens.appendChild(d);
      });
      body.appendChild(tokens);

      // code box
      const codeBox = document.createElement('div'); codeBox.className = 'code-box lined';
      const codeHead = document.createElement('div'); codeHead.className = 'code-head';
      codeHead.innerHTML = `<div class="meta">كود تجريبي</div><div class="meta">نسخ / محاكي</div>`;
      const codeBody = document.createElement('div'); codeBody.className = 'code-body';
      const pre = document.createElement('pre');
      const codeEl = document.createElement('code');

      // render numbered lines
      const numbered = lesson.code.split('\n').map(line => {
        // preserve trailing spaces
        return `<span>${escapeHtml(line)}</span>`;
      }).join('\n');
      codeEl.innerHTML = numbered;
      pre.appendChild(codeEl);
      codeBody.appendChild(pre);
      codeBox.appendChild(codeHead);
      codeBox.appendChild(codeBody);
      body.appendChild(codeBox);

      // tip
      if(lesson.tips){
        const tip = document.createElement('div'); tip.className = 'tip'; tip.textContent = 'نصيحة: ' + lesson.tips;
        body.appendChild(tip);
      }

      wrap.appendChild(head);
      wrap.appendChild(body);

      // events
      copyBtn.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(lesson.code);
          const old = copyBtn.textContent;
          copyBtn.textContent = 'تم النسخ ✅';
          setTimeout(()=> copyBtn.textContent = old, 1200);
        }catch(e){
          alert('فشل النسخ. استخدم النسخ اليدوي.');
        }
      });

      openBtn.addEventListener('click', ()=>{
        // open Wokwi inside modal iframe
        openSimulator(lesson.title, lesson.code);
      });

      return wrap;
    }

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[ch]));
    }

    // render all
    extraLessons.forEach(ls=>{
      tocList.appendChild(makeTOCItem(ls));
      lessonsList.appendChild(makeLessonCard(ls));
    });

    // Search
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    searchInput.addEventListener('input', ()=>{
      const q = searchInput.value.trim().toLowerCase();
      document.querySelectorAll('.lesson').forEach(card=>{
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? '' : 'none';
      });
    });
    clearSearch.addEventListener('click', ()=>{
      searchInput.value = '';
      searchInput.dispatchEvent(new Event('input'));
    });

    // Simulator modal
    const iframeModal = document.getElementById('iframeModal');
    const simFrame = document.getElementById('simFrame');
    const iframeTitle = document.getElementById('iframeTitle');
    const closeIframe = document.getElementById('closeIframe');

    function openSimulator(title, code){
      iframeTitle.textContent = title + ' — المحاكي';
      // Wokwi supports sketch param
      const url = 'https://wokwi.com/arduino/new?sketch=' + encodeURIComponent(code);
      simFrame.src = url;
      iframeModal.style.display = 'flex';
      iframeModal.setAttribute('aria-hidden', 'false');
    }
    closeIframe.addEventListener('click', ()=>{
      simFrame.src = 'about:blank';
      iframeModal.style.display = 'none';
      iframeModal.setAttribute('aria-hidden', 'true');
    });
    // close on backdrop click
    iframeModal.addEventListener('click', (e)=>{
      if(e.target === iframeModal) closeIframe.click();
    });

    // keyboard accessibility: close modal with Esc
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && iframeModal.style.display === 'flex') closeIframe.click();
    });

    // smooth scroll for TOC links
    document.querySelectorAll('.toc a').forEach(a=>{
      a.addEventListener('click', (ev)=>{
        ev.preventDefault();
        const id = a.getAttribute('href').slice(1);
        const el = document.getElementById(id);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    // ensure initial focusable elements for accessibility
    searchInput.setAttribute('aria-label', 'بحث في الدروس');
    closeIframe.setAttribute('aria-label', 'إغلاق المحاكي');

  </script>
</body>
</html>
